{
    "docs": [
        {
            "location": "/",
            "text": "Logicpulse LogicPos : Install Binary/Pre Compiled Version Quick Setup Notes\n\n\n\n\nWindows RunTime Requirements\n\n\n1) Install \nMicrosoft .NET Framework 4.6.1\n\n\n2) \nGTK 2.12.22+\n\n\n\n\nNote\n\n\ninstaller in folder \nothers\\windowsruntime\\gtk-sharp-2.12.22.msi\n\n\n\n\n3) Install GTK Nodoka Theme Engine\n\n\ncopy \nothers\\windowsruntime\\libnodoka.dll\n to\n   \nc:\\Program Files\\GtkSharp\\2.12\\lib\\gtk-2.0\\2.10.0\\engines\\\n (32bit), or \n   \nc:\\Program Files (x86)\\GtkSharp\\2.12\\lib\\gtk-2.0\\2.10.0\\engines\\\n (64bit)\n\n\n4) Required to Restart Windows (GTK Runtime Requirement)\n\n\n5) Now we can install/Run LogicPos\n\n\n\n\nDatabase Requirements\n\n\nTo work with LogicPos we need a data store, currently we can use \nMySql Server\n, \nMiscrosoft SqlServer\n or \nSqlite\n, bu technically we can use any data source comopatible with \neXpressPersistent Objects\u2122 (XPO)\n \n\n\n\n\nNote\n\n\nTo work with \nMySql Server\n or \nMiscrosoft SqlServer\n we need first to install server\n\n\nTo Work With \nSqlite\n we dont need to install anything\n\n\n\n\n\n\n\n\n\n\nTip\n\n\nRecommended data sources: Mysql and SqlServer\n\n\n\n\n\n\n\n\n\n\nConfigure LogicPos Database Connection\n\n\nAfter we choose a data store we need to configure it in application config \n\n\nOpen and edit config \nlogicpos\\bin\\Debug\\logicpos.exe.config\n \n\n\nConfigure Database\n\n\n\n\nOption #1 : Mysql\n\n\n\n\nTo work with \nMySql\n we need to edit \nxpoConnectionString\n to connect to local or remote \nMySql Server Instance\n\n\nlocal\n\n\n<add\n \nkey=\n\"databaseType\"\n \nvalue=\n\"MySql\"\n \n/>\n\n\n<add\n \nkey=\n\"xpoConnectionString\"\n \nvalue=\n\"XpoProvider=MySql;server=localhost;database={0};user id=root;password=PASSWORD;persist security info=true;CharSet=utf8;\"\n \n/>\n\n\n\n\n\n\n\n\nNote\n\n\nFor remote server change \nlocalhost\n with remote ip, for ex \n192.168.1.1\n\nDont forget to change \nuser id\n, \npassword\n according your needs.\n\n\n\n\n\n\nOption #2 : SqlServer\n\n\n\n\nTo work with \nSqlServer\n we need to edit \nxpoConnectionString\n to point to our \nSqlServer Server Instance\n\n\nlocal\n\n\n<add\n \nkey=\n\"databaseType\"\n \nvalue=\n\"MSSqlServer\"\n \n/>\n\n\n<add\n \nkey=\n\"xpoConnectionString\"\n \nvalue=\n\"XpoProvider=MSSqlServer;Data Source=SERVER\\sql2008;Initial Catalog={0};User ID=sa;Password=PASSWORD;Persist Security Info=true;\"\n \n/>\n\n\n\n\n\n\n\n\nNote\n\n\nDont forget to change \nuser id\n, \npassword\n according your needs.\n\n\n\n\n\n\nOption #3 : SqlServer Express\n\n\n\n\nTo work with \nSqlServer Express\n we need to edit \nxpoConnectionString\n to point to our \nSqlServer Express Instance\n, the connection string is a little diferent\n\n\n<add\n \nkey=\n\"databaseType\"\n \nvalue=\n\"MSSqlServer\"\n \n/>\n\n\n<add\n \nkey=\n\"xpoConnectionString\"\n \nvalue=\n\"XpoProvider=MSSqlServer;Data Source=.\\SQLEXPRESS;Initial Catalog={0};User ID=mario.monteiro;Password=logicpulse#2014;Persist Security Info=true;Integrated Security=SSPI;Pooling=false;\"\n \n/>\n\n\n\n\n\n\n\n\nOption #4 : Sqlite\n\n\n\n\n<add\n \nkey=\n\"databaseType\"\n \nvalue=\n\"SQLite\"\n \n/>\n\n\n<add\n \nkey=\n\"xpoConnectionString\"\n \nvalue=\n\"XpoProvider=MonoLite;uri=file:{0}.db\"\n \n/>\n\n\n\n\n\n\n\n\nRun LogicPos\n\n\nAfter \nConfigure LogicPos Database Connection\n we can run LogicPos from \nlogicpos\\bin\\Debug\\logicpos.exe\n \n\n\n\n\nTip\n\n\n\n\nTip\"\n    If we have problems running LogicPos we can look or tail the log locate at \nlogicpos\\bin\\Debug\\logicpos.log\n\n\n\n\nInstall AT WebService from Binaries/Pre compiled\n\n\nAfter successfully run LogicPos, we can setup AT WebServices to test with AT SandBox (Test Mode)\n\n\nWeb Service Config Parameters\n\n\nLogicposFinancialService.exe.config\n\n\n<!--Global|Shared for DC|WB-->\n\n\n<add\n \nkey=\n\"servicesATRequestTimeout\"\n \nvalue=\n\"5000\"\n \n/>\n \n<!--Default:5000|Disabled:-1-->\n\n\n<add\n \nkey=\n\"servicesATTestModeFilePublicKey\"\n \nvalue=\n\"ChavePublicaAT.cer\"\n \n/>\n\n\n<add\n \nkey=\n\"servicesATTestModeFileCertificate\"\n \nvalue=\n\"TesteWebservice.pfx\"\n \n/>\n\n\n<add\n \nkey=\n\"servicesATProdModeFilePublicKey\"\n \nvalue=\n\"000000000_0000.cer\"\n \n/>\n\n\n<add\n \nkey=\n\"servicesATProdModeFileCertificate\"\n \nvalue=\n\"000000000.pfx\"\n \n/>\n\n\n<!--DC:Documents-->\n\n\n<add\n \nkey=\n\"servicesATDCTestMode\"\n \nvalue=\n\"true\"\n \n/>\n\n\n<!--WB:WayBill Documents-->\n\n\n<add\n \nkey=\n\"servicesATWBTestMode\"\n \nvalue=\n\"true\"\n \n/>\n\n\n<add\n \nkey=\n\"servicesATWBAgriculturalMode\"\n \nvalue=\n\"true\"\n \n/>\n\n\n\n\n\n\n\n\nNote\n\n\nATProd\n configs corresponds own company certificates, here are ommited with \n000000000\n\n\n\n\n\n\nNote\n\n\n\n\n\"Note\"\n    Above config is working in test mode/sandbox, note the follow config parametes \nservicesATDCTestMode\n, \nservicesATWBTestMode\n and \nservicesATWBAgriculturalMode\n enabled with \ntrue\n, to enable production mode change \ntrue\n to \nfalse\n and put your own certificates in directory, and change filess in \nservicesATProdModeFilePublicKey\n and \nservicesATProdModeFileCertificate\n\n\nWindows Install Service\n\n\n\n\nNote\n\n\n\n\n\n\nWe need a full path to \nLogicposFinancialService.exe\n to install windows service, here we use \nlogicpos\\bin\\Debug\\LogicposFinancialService.exe\n located in development environment, inside Debug folder\n\n\n\n\n\n\nChange path according your needs, edit \nlogicpos\\bin\\Debug\\Scripts\\Win\\AtWs\\service_install.bat\n and check path to \nLogicposFinancialService.exe\n\n\n\n\n\n\nDefault in \nservice_install.bat\n is: \n\n\n\n\n\n\nSC create logicpulselogicposfinancialservice displayname= \"LogicPulse LogicPos Financial Service\" binpath= \"\\\"c:\\SVN\\logicpos\\trunk\\src\\logicpos\\logicpos_pos_opensource\\logicpos\\bin\\Debug\\LogicposFinancialService.exe\\\"\" start= auto\n\n\n\n\n1) Open a command line with adminstrator privileges and type above commands\n\n\ncd\n c:\n\\S\nVN\n\\l\nogicpos\n\\t\nrunk\n\\s\nrc\n\\l\nogicpos\n\\l\nogicpos_pos_opensource\n\\l\nogicpos\n\\b\nin\n\\D\nebug\n\\S\ncripts\n\\W\nin\n\\A\ntWs \nservice_install.bat\n\n\n[\nSC\n]\n CreateService SUCCESS\n\n\n\n\n\nIf service is installed succefully, we receive a \n[SC] CreateService SUCCESS\n return message, like we see above\n\n\n2) Check if service is installed in windows, open windows services and find \nLogicPulse LogicPos Financial Service\n\n\n\n\n2) We must assign a user to run the service, else we have error permissions \nlocating and use certificates\n, press right mouse in service to pull context menu, and choose properties, next assign a user to service, using username and passoword\n\n\n\n\n3) Test and Run Service, press right mouse in service to pull context menu, and choose start\n\n\n4) Test Service Url \nhttp://localhost:50391/Service1.svc\n\n\n\n\nUninstall, Start and Stop Bats\n\n\nTo \nInstall\n, \nUnistall\n, \nStart\n or \nStop\n we can use above bats, or use windows services control pannel\n\n\nlogicpos.framework\\logicpos.financial.service\\Utils\\service_start.bat\nlogicpos.framework\\logicpos.financial.service\\Utils\\service_stop.bat\nlogicpos.framework\\logicpos.financial.service\\Utils\\service_uninstall.bat\n\n\n\n\n\nLocation of Certificates\n\n\nAT WebService\n requires certificates to work, currently the LogicPos distro has \nTesteWebService\n certificates pre installed in directory \nResources\\Certificates\n\n\nex\n\n\nResources\\Certificates\\508278155.pfx\nResources\\Certificates\\508278155_1115.bat\nResources\\Certificates\\508278155_1115.cer\nResources\\Certificates\\ChavePublicaAT.cer\nResources\\Certificates\\TesteWebservice.pfx\n\n\n\n\n\nTest/Enable AT WebService\n\n\nFirst edit webservice config files\nLogicposFinancialService.exe.config\n (runtime), or \nlogicpos.financial\\logicpos.financial.service\\App.config\n (devenv) \nlogicpos config files and change \nserviceATSendDocuments\n and \nserviceATSendDocumentsWayBill\n to true to enable send documents, else webservice ignore send documents, we need to change both configurations.\n\n\nTo test AT WebService, and after start windows service (above steps), we can launch LogicPos and emmit some \nFinancial\n and \nWayBill Documents\n, they use a diferent endpoint in AT WebServices, its advised to test both\n\n\nAgain we can view/tail the log file, to expose whats appening with windows service, the log file is located in \nlogicpos.framework\\logicpos.financial.service\\bin\\Debug\\logicpos.financial.service.log\n\n\nwe can use a tool like \nbaretail\n to tail the log\n\n\nwe can see service bootstrap like:\n\n\n2018-04-17\n \n10\n:\n44\n:\n00\n,\n748\n \n[\nINFO\n \n]\n \nlogicpos\n.\nfinancial\n.\nservice\n.\nProgram\n \n:\n \nInit\n \nXpoDefault\n.\nDataLayer\n:\n \n[\nXpoProvider\n=\nMySql\n;\nserver\n=\nlocalhost\n;\ndatabase\n=\nlogicposdb\n;\nuser\n \nid\n=\nroot\n;\npassword\n=\nadmin\n#\n;\npersist\n \nsecurity\n \ninfo\n=\ntrue\n;\nCharSet\n=\nutf8\n;\n]\n\n\n2018-04-17\n \n10\n:\n44\n:\n02\n,\n210\n \n[\nDEBUG\n]\n \nlogicpos\n.\nfinancial\n.\nservice\n.\nObjects\n.\nUtils\n \n:\n \nBootStrap\n \nFramework\n \nConsole\n \nService\n \nProject\n....\n\n\n2018-04-17\n \n10\n:\n44\n:\n02\n,\n210\n \n[\nDEBUG\n]\n \nlogicpos\n.\nfinancial\n.\nservice\n.\nObjects\n.\nUtils\n \n:\n \nServicesATEnableTestMode\n:\n \n[\nTrue\n]\n\n\n2018-04-17\n \n10\n:\n44\n:\n02\n,\n211\n \n[\nDEBUG\n]\n \nlogicpos\n.\nfinancial\n.\nservice\n.\nProgram\n \n:\n \nService\n \nURI\n:\n \nhttp\n://\nlocalhost\n:\n50391\n/\nService1\n.\nsvc\n\n\n2018-04-17\n \n10\n:\n44\n:\n02\n,\n211\n \n[\nDEBUG\n]\n \nlogicpos\n.\nfinancial\n.\nservice\n.\nObjects\n.\nUtils\n \n:\n \nLaunch\n \nservice\n?\n \n[\nY\n \nor\n \nEnter\n]\n \nor\n \nany\n \nother\n \nkey\n \nto\n \nrun\n \nin\n \ninteractive\n \ndevelop\n/\ndebug\n \nmode\n\n\n2018-04-17\n \n10\n:\n47\n:\n25\n,\n521\n \n[\nINFO\n \n]\n \nlogicpos\n.\nfinancial\n.\nservice\n.\nProgram\n \n:\n \nInit\n \nXpoDefault\n.\nDataLayer\n:\n \n[\nXpoProvider\n=\nMySql\n;\nserver\n=\nlocalhost\n;\ndatabase\n=\nlogicposdb\n;\nuser\n \nid\n=\nroot\n;\npassword\n=\nadmin\n#\n;\npersist\n \nsecurity\n \ninfo\n=\ntrue\n;\nCharSet\n=\nutf8\n;\n]\n\n\n2018-04-17\n \n10\n:\n47\n:\n26\n,\n141\n \n[\nDEBUG\n]\n \nlogicpos\n.\nfinancial\n.\nservice\n.\nObjects\n.\nUtils\n \n:\n \nBootStrap\n \nFramework\n \nConsole\n \nService\n \nProject\n....\n\n\n2018-04-17\n \n10\n:\n47\n:\n26\n,\n141\n \n[\nDEBUG\n]\n \nlogicpos\n.\nfinancial\n.\nservice\n.\nObjects\n.\nUtils\n \n:\n \nServicesATEnableTestMode\n:\n \n[\nTrue\n]\n\n\n2018-04-17\n \n10\n:\n47\n:\n26\n,\n141\n \n[\nDEBUG\n]\n \nlogicpos\n.\nfinancial\n.\nservice\n.\nProgram\n \n:\n \nService\n \nURI\n:\n \nhttp\n://\nlocalhost\n:\n50391\n/\nService1\n.\nsvc\n\n\n2018-04-17\n \n10\n:\n47\n:\n26\n,\n141\n \n[\nDEBUG\n]\n \nlogicpos\n.\nfinancial\n.\nservice\n.\nObjects\n.\nService\n.\nService\n \n:\n \nService\n \nConstruct\n\n\n2018-04-17\n \n10\n:\n47\n:\n26\n,\n141\n \n[\nDEBUG\n]\n \nlogicpos\n.\nfinancial\n.\nservice\n.\nProgram\n \n:\n \nService\n.\nRun\n(\nservice\n)\n\n\n2018-04-17\n \n10\n:\n47\n:\n26\n,\n144\n \n[\nDEBUG\n]\n \nlogicpos\n.\nfinancial\n.\nservice\n.\nObjects\n.\nService\n.\nService\n \n:\n \nService\n \nOnStart\n\n\n2018-04-17\n \n10\n:\n47\n:\n26\n,\n161\n \n[\nDEBUG\n]\n \nlogicpos\n.\nfinancial\n.\nservice\n.\nProgram\n \n:\n \nService\n \nStarted\n\n\n2018-04-17\n \n10\n:\n47\n:\n26\n,\n162\n \n[\nDEBUG\n]\n \nlogicpos\n.\nfinancial\n.\nservice\n.\nObjects\n.\nUtils\n \n:\n \nModifyHttpSettings\n:\n \n'netsh http add urlacl url=http://+:50391/ user=\\Todos'\n\n\n\n\n\n\nStart Service Log and Emmit Some Financial Invoices Documents\n\n\n\n\nlog\n\n\nSend Document DocumentNumber: [FS FS002012018S01/29]/WayBillMode: [False]\nSend Document ReturnCode: [0]\nSend Document ReturnMessage: [Documento registado com sucesso.]\nSend Document DocumentNumber: [FS FS002012018S01/30]/WayBillMode: [False]\nSend Document ReturnCode: [0]\nSend Document ReturnMessage: [Documento registado com sucesso.]\nSend Document DocumentNumber: [GT GT002012018S01/5]/WayBillMode: [True]\nSend Document ReturnCode: [0]\nSend Document ReturnMessage: [OK]\n\n\n\n\n\nIf everything is Ok we can see that we have communication with TestMode WebService in above log and dont have any errors. ex \nSend Document ReturnMessage: [OK]\n\n\n\n\nAT WebService problem Resolution\n\n\nSometimes we can get some problems like:\n\n\nWrong database in Config\n\n\n\n\nIf we get errors with invalid documents, the cause can be wrong database configuration, sometimes we change default database name \nlogicposdb\n in development environment, both logicpos and webservice must be using same database, else webservice cant find document in database, to fix this use same database name in logicpos and webservice\n\n\nlog\n\n\n2018\n-\n04\n-\n17\n \n11\n:\n42\n:\n55\n,\n808\n \n[\nDEBUG\n]\n \nlogicpos\n.\nfinancial\n.\nservice\n.\nObjects\n.\nUtils\n \n:\n \nError\n \n202\n:\n \n[\nDocumento\n \nInv\u00e1lido\n:\n \n321\na84c4\n-\n677\na\n-\n4\nea1\n-\na024\n-\n860e87\na960e1\n]\n\n\n\n\n\n\nCorrect the database name on SettingsApp.cs on both projects\n\n\npublic\n \nstatic\n \nstring\n \nDatabaseName\n \n=\n \n\"logicposdb\"\n;\n\n\n\n\n\n\nProblems With Expired Certificate\n\n\nSometimes we get this type of error in logs\n\n\n2018-04-17 12:30:57,035 [DEBUG] logicpos.financial.service.Objects.Utils : Send Document DocumentNumber: [FS FS008012018S01/1]/WayBillMode: [False]\n2018-04-17 12:30:57,120 [DEBUG] logicpos.financial.service.Objects.Utils : Cert Subject: [CN=TesteWebServices, OU=ASI, O=AT - Autoridade Tributaria e Aduaneira, L=Lisboa, S=Lisboa, C=PT], NotBefore: [02/08/2017 15:06:39], NotAfter: [29/01/2018 14:06:39]\n2018-04-17 12:30:57,329 [ERROR] logicpos.financial.service.Objects.Modules.AT.ServicesAT : A liga\u00e7\u00e3o subjacente foi fechada: Erro inesperado ao enviar.\nSystem.Net.WebException: A liga\u00e7\u00e3o subjacente foi fechada: Erro inesperado ao enviar. ---> System.IO.IOException: Falha da autentica\u00e7\u00e3o porque a parte remota fechou a sequ\u00eancia de transporte.\n   em System.Net.Security.SslState.StartReadFrame(Byte[] buffer, Int32 readBytes, AsyncProtocolRequest asyncRequest)\n....   \n2018-04-17 12:30:57,397 [DEBUG] logicpos.financial.service.Objects.Utils : Exception: [A liga\u00e7\u00e3o subjacente foi fechada: Erro inesperado ao enviar.]\n2018-04-17 12:30:57,511 [DEBUG] logicpos.financial.service.Objects.Utils : Error 200: [A liga\u00e7\u00e3o subjacente foi fechada: Erro inesperado ao enviar.]\n\n\n\n\n\nThe cause is that Test certificates has been expired \nNotBefore: [02/08/2017 15:06:39], NotAfter: [29/01/2018 14:06:39]\n\n\nWhen this occur we must login in \nfaturas.portaldasfinancas.gov.pt\n and \ndownload updated certicates\n\n\n\n\nWe can get certificates from this link \ncertificados.zip\n or go to \ncertificados link\n\n\nAfter we download certificados.zip we must extract to Runtime/Development folders to update old expired certificates, but first we must stop windows service, to prevent above error replacing certificate\n\n\n\n\n1) extract and copy \n\n\nTesteWebServices.pfx > Resources\\Certificates\\TesteWebService.pfx\nChave Cifra Publica AT (Produ\u00e7\u00e3o).cer > Resources\\Certificates\\ChavePublicaAT.cer\n\n\n\n\n\n\n\nWarning\n\n\nFilenames are diferent from target filenames, and note that we removed last \n[s]\n from TesteWebService\n[s]\n.pfx\n\n\n\n\n2) Restart windows service and test again",
            "title": "Logicpulse LogicPos : Install Binary/Pre Compiled Version Quick Setup Notes"
        },
        {
            "location": "/#logicpulse-logicpos-install-binarypre-compiled-version-quick-setup-notes",
            "text": "",
            "title": "Logicpulse LogicPos : Install Binary/Pre Compiled Version Quick Setup Notes"
        },
        {
            "location": "/#windows-runtime-requirements",
            "text": "1) Install  Microsoft .NET Framework 4.6.1  2)  GTK 2.12.22+   Note  installer in folder  others\\windowsruntime\\gtk-sharp-2.12.22.msi   3) Install GTK Nodoka Theme Engine  copy  others\\windowsruntime\\libnodoka.dll  to\n    c:\\Program Files\\GtkSharp\\2.12\\lib\\gtk-2.0\\2.10.0\\engines\\  (32bit), or \n    c:\\Program Files (x86)\\GtkSharp\\2.12\\lib\\gtk-2.0\\2.10.0\\engines\\  (64bit)  4) Required to Restart Windows (GTK Runtime Requirement)  5) Now we can install/Run LogicPos",
            "title": "Windows RunTime Requirements"
        },
        {
            "location": "/#database-requirements",
            "text": "To work with LogicPos we need a data store, currently we can use  MySql Server ,  Miscrosoft SqlServer  or  Sqlite , bu technically we can use any data source comopatible with  eXpressPersistent Objects\u2122 (XPO)     Note  To work with  MySql Server  or  Miscrosoft SqlServer  we need first to install server  To Work With  Sqlite  we dont need to install anything      Tip  Recommended data sources: Mysql and SqlServer",
            "title": "Database Requirements"
        },
        {
            "location": "/#configure-logicpos-database-connection",
            "text": "After we choose a data store we need to configure it in application config   Open and edit config  logicpos\\bin\\Debug\\logicpos.exe.config    Configure Database   Option #1 : Mysql   To work with  MySql  we need to edit  xpoConnectionString  to connect to local or remote  MySql Server Instance  local  <add   key= \"databaseType\"   value= \"MySql\"   />  <add   key= \"xpoConnectionString\"   value= \"XpoProvider=MySql;server=localhost;database={0};user id=root;password=PASSWORD;persist security info=true;CharSet=utf8;\"   />    Note  For remote server change  localhost  with remote ip, for ex  192.168.1.1 \nDont forget to change  user id ,  password  according your needs.    Option #2 : SqlServer   To work with  SqlServer  we need to edit  xpoConnectionString  to point to our  SqlServer Server Instance  local  <add   key= \"databaseType\"   value= \"MSSqlServer\"   />  <add   key= \"xpoConnectionString\"   value= \"XpoProvider=MSSqlServer;Data Source=SERVER\\sql2008;Initial Catalog={0};User ID=sa;Password=PASSWORD;Persist Security Info=true;\"   />    Note  Dont forget to change  user id ,  password  according your needs.    Option #3 : SqlServer Express   To work with  SqlServer Express  we need to edit  xpoConnectionString  to point to our  SqlServer Express Instance , the connection string is a little diferent  <add   key= \"databaseType\"   value= \"MSSqlServer\"   />  <add   key= \"xpoConnectionString\"   value= \"XpoProvider=MSSqlServer;Data Source=.\\SQLEXPRESS;Initial Catalog={0};User ID=mario.monteiro;Password=logicpulse#2014;Persist Security Info=true;Integrated Security=SSPI;Pooling=false;\"   />    Option #4 : Sqlite   <add   key= \"databaseType\"   value= \"SQLite\"   />  <add   key= \"xpoConnectionString\"   value= \"XpoProvider=MonoLite;uri=file:{0}.db\"   />",
            "title": "Configure LogicPos Database Connection"
        },
        {
            "location": "/#run-logicpos",
            "text": "After  Configure LogicPos Database Connection  we can run LogicPos from  logicpos\\bin\\Debug\\logicpos.exe     Tip   Tip\"\n    If we have problems running LogicPos we can look or tail the log locate at  logicpos\\bin\\Debug\\logicpos.log",
            "title": "Run LogicPos"
        },
        {
            "location": "/#install-at-webservice-from-binariespre-compiled",
            "text": "After successfully run LogicPos, we can setup AT WebServices to test with AT SandBox (Test Mode)  Web Service Config Parameters  LogicposFinancialService.exe.config  <!--Global|Shared for DC|WB-->  <add   key= \"servicesATRequestTimeout\"   value= \"5000\"   />   <!--Default:5000|Disabled:-1-->  <add   key= \"servicesATTestModeFilePublicKey\"   value= \"ChavePublicaAT.cer\"   />  <add   key= \"servicesATTestModeFileCertificate\"   value= \"TesteWebservice.pfx\"   />  <add   key= \"servicesATProdModeFilePublicKey\"   value= \"000000000_0000.cer\"   />  <add   key= \"servicesATProdModeFileCertificate\"   value= \"000000000.pfx\"   />  <!--DC:Documents-->  <add   key= \"servicesATDCTestMode\"   value= \"true\"   />  <!--WB:WayBill Documents-->  <add   key= \"servicesATWBTestMode\"   value= \"true\"   />  <add   key= \"servicesATWBAgriculturalMode\"   value= \"true\"   />    Note  ATProd  configs corresponds own company certificates, here are ommited with  000000000    Note   \"Note\"\n    Above config is working in test mode/sandbox, note the follow config parametes  servicesATDCTestMode ,  servicesATWBTestMode  and  servicesATWBAgriculturalMode  enabled with  true , to enable production mode change  true  to  false  and put your own certificates in directory, and change filess in  servicesATProdModeFilePublicKey  and  servicesATProdModeFileCertificate  Windows Install Service   Note    We need a full path to  LogicposFinancialService.exe  to install windows service, here we use  logicpos\\bin\\Debug\\LogicposFinancialService.exe  located in development environment, inside Debug folder    Change path according your needs, edit  logicpos\\bin\\Debug\\Scripts\\Win\\AtWs\\service_install.bat  and check path to  LogicposFinancialService.exe    Default in  service_install.bat  is:     SC create logicpulselogicposfinancialservice displayname= \"LogicPulse LogicPos Financial Service\" binpath= \"\\\"c:\\SVN\\logicpos\\trunk\\src\\logicpos\\logicpos_pos_opensource\\logicpos\\bin\\Debug\\LogicposFinancialService.exe\\\"\" start= auto   1) Open a command line with adminstrator privileges and type above commands  cd  c: \\S VN \\l ogicpos \\t runk \\s rc \\l ogicpos \\l ogicpos_pos_opensource \\l ogicpos \\b in \\D ebug \\S cripts \\W in \\A tWs \nservice_install.bat [ SC ]  CreateService SUCCESS  If service is installed succefully, we receive a  [SC] CreateService SUCCESS  return message, like we see above  2) Check if service is installed in windows, open windows services and find  LogicPulse LogicPos Financial Service   2) We must assign a user to run the service, else we have error permissions  locating and use certificates , press right mouse in service to pull context menu, and choose properties, next assign a user to service, using username and passoword   3) Test and Run Service, press right mouse in service to pull context menu, and choose start  4) Test Service Url  http://localhost:50391/Service1.svc   Uninstall, Start and Stop Bats  To  Install ,  Unistall ,  Start  or  Stop  we can use above bats, or use windows services control pannel  logicpos.framework\\logicpos.financial.service\\Utils\\service_start.bat\nlogicpos.framework\\logicpos.financial.service\\Utils\\service_stop.bat\nlogicpos.framework\\logicpos.financial.service\\Utils\\service_uninstall.bat  Location of Certificates  AT WebService  requires certificates to work, currently the LogicPos distro has  TesteWebService  certificates pre installed in directory  Resources\\Certificates  ex  Resources\\Certificates\\508278155.pfx\nResources\\Certificates\\508278155_1115.bat\nResources\\Certificates\\508278155_1115.cer\nResources\\Certificates\\ChavePublicaAT.cer\nResources\\Certificates\\TesteWebservice.pfx  Test/Enable AT WebService  First edit webservice config files LogicposFinancialService.exe.config  (runtime), or  logicpos.financial\\logicpos.financial.service\\App.config  (devenv) \nlogicpos config files and change  serviceATSendDocuments  and  serviceATSendDocumentsWayBill  to true to enable send documents, else webservice ignore send documents, we need to change both configurations.  To test AT WebService, and after start windows service (above steps), we can launch LogicPos and emmit some  Financial  and  WayBill Documents , they use a diferent endpoint in AT WebServices, its advised to test both  Again we can view/tail the log file, to expose whats appening with windows service, the log file is located in  logicpos.framework\\logicpos.financial.service\\bin\\Debug\\logicpos.financial.service.log  we can use a tool like  baretail  to tail the log  we can see service bootstrap like:  2018-04-17   10 : 44 : 00 , 748   [ INFO   ]   logicpos . financial . service . Program   :   Init   XpoDefault . DataLayer :   [ XpoProvider = MySql ; server = localhost ; database = logicposdb ; user   id = root ; password = admin # ; persist   security   info = true ; CharSet = utf8 ; ]  2018-04-17   10 : 44 : 02 , 210   [ DEBUG ]   logicpos . financial . service . Objects . Utils   :   BootStrap   Framework   Console   Service   Project ....  2018-04-17   10 : 44 : 02 , 210   [ DEBUG ]   logicpos . financial . service . Objects . Utils   :   ServicesATEnableTestMode :   [ True ]  2018-04-17   10 : 44 : 02 , 211   [ DEBUG ]   logicpos . financial . service . Program   :   Service   URI :   http :// localhost : 50391 / Service1 . svc  2018-04-17   10 : 44 : 02 , 211   [ DEBUG ]   logicpos . financial . service . Objects . Utils   :   Launch   service ?   [ Y   or   Enter ]   or   any   other   key   to   run   in   interactive   develop / debug   mode  2018-04-17   10 : 47 : 25 , 521   [ INFO   ]   logicpos . financial . service . Program   :   Init   XpoDefault . DataLayer :   [ XpoProvider = MySql ; server = localhost ; database = logicposdb ; user   id = root ; password = admin # ; persist   security   info = true ; CharSet = utf8 ; ]  2018-04-17   10 : 47 : 26 , 141   [ DEBUG ]   logicpos . financial . service . Objects . Utils   :   BootStrap   Framework   Console   Service   Project ....  2018-04-17   10 : 47 : 26 , 141   [ DEBUG ]   logicpos . financial . service . Objects . Utils   :   ServicesATEnableTestMode :   [ True ]  2018-04-17   10 : 47 : 26 , 141   [ DEBUG ]   logicpos . financial . service . Program   :   Service   URI :   http :// localhost : 50391 / Service1 . svc  2018-04-17   10 : 47 : 26 , 141   [ DEBUG ]   logicpos . financial . service . Objects . Service . Service   :   Service   Construct  2018-04-17   10 : 47 : 26 , 141   [ DEBUG ]   logicpos . financial . service . Program   :   Service . Run ( service )  2018-04-17   10 : 47 : 26 , 144   [ DEBUG ]   logicpos . financial . service . Objects . Service . Service   :   Service   OnStart  2018-04-17   10 : 47 : 26 , 161   [ DEBUG ]   logicpos . financial . service . Program   :   Service   Started  2018-04-17   10 : 47 : 26 , 162   [ DEBUG ]   logicpos . financial . service . Objects . Utils   :   ModifyHttpSettings :   'netsh http add urlacl url=http://+:50391/ user=\\Todos'   Start Service Log and Emmit Some Financial Invoices Documents   log  Send Document DocumentNumber: [FS FS002012018S01/29]/WayBillMode: [False]\nSend Document ReturnCode: [0]\nSend Document ReturnMessage: [Documento registado com sucesso.]\nSend Document DocumentNumber: [FS FS002012018S01/30]/WayBillMode: [False]\nSend Document ReturnCode: [0]\nSend Document ReturnMessage: [Documento registado com sucesso.]\nSend Document DocumentNumber: [GT GT002012018S01/5]/WayBillMode: [True]\nSend Document ReturnCode: [0]\nSend Document ReturnMessage: [OK]  If everything is Ok we can see that we have communication with TestMode WebService in above log and dont have any errors. ex  Send Document ReturnMessage: [OK]",
            "title": "Install AT WebService from Binaries/Pre compiled"
        },
        {
            "location": "/#at-webservice-problem-resolution",
            "text": "Sometimes we can get some problems like:  Wrong database in Config   If we get errors with invalid documents, the cause can be wrong database configuration, sometimes we change default database name  logicposdb  in development environment, both logicpos and webservice must be using same database, else webservice cant find document in database, to fix this use same database name in logicpos and webservice  log  2018 - 04 - 17   11 : 42 : 55 , 808   [ DEBUG ]   logicpos . financial . service . Objects . Utils   :   Error   202 :   [ Documento   Inv\u00e1lido :   321 a84c4 - 677 a - 4 ea1 - a024 - 860e87 a960e1 ]   Correct the database name on SettingsApp.cs on both projects  public   static   string   DatabaseName   =   \"logicposdb\" ;",
            "title": "AT WebService problem Resolution"
        },
        {
            "location": "/#problems-with-expired-certificate",
            "text": "Sometimes we get this type of error in logs  2018-04-17 12:30:57,035 [DEBUG] logicpos.financial.service.Objects.Utils : Send Document DocumentNumber: [FS FS008012018S01/1]/WayBillMode: [False]\n2018-04-17 12:30:57,120 [DEBUG] logicpos.financial.service.Objects.Utils : Cert Subject: [CN=TesteWebServices, OU=ASI, O=AT - Autoridade Tributaria e Aduaneira, L=Lisboa, S=Lisboa, C=PT], NotBefore: [02/08/2017 15:06:39], NotAfter: [29/01/2018 14:06:39]\n2018-04-17 12:30:57,329 [ERROR] logicpos.financial.service.Objects.Modules.AT.ServicesAT : A liga\u00e7\u00e3o subjacente foi fechada: Erro inesperado ao enviar.\nSystem.Net.WebException: A liga\u00e7\u00e3o subjacente foi fechada: Erro inesperado ao enviar. ---> System.IO.IOException: Falha da autentica\u00e7\u00e3o porque a parte remota fechou a sequ\u00eancia de transporte.\n   em System.Net.Security.SslState.StartReadFrame(Byte[] buffer, Int32 readBytes, AsyncProtocolRequest asyncRequest)\n....   \n2018-04-17 12:30:57,397 [DEBUG] logicpos.financial.service.Objects.Utils : Exception: [A liga\u00e7\u00e3o subjacente foi fechada: Erro inesperado ao enviar.]\n2018-04-17 12:30:57,511 [DEBUG] logicpos.financial.service.Objects.Utils : Error 200: [A liga\u00e7\u00e3o subjacente foi fechada: Erro inesperado ao enviar.]  The cause is that Test certificates has been expired  NotBefore: [02/08/2017 15:06:39], NotAfter: [29/01/2018 14:06:39]  When this occur we must login in  faturas.portaldasfinancas.gov.pt  and  download updated certicates   We can get certificates from this link  certificados.zip  or go to  certificados link  After we download certificados.zip we must extract to Runtime/Development folders to update old expired certificates, but first we must stop windows service, to prevent above error replacing certificate   1) extract and copy   TesteWebServices.pfx > Resources\\Certificates\\TesteWebService.pfx\nChave Cifra Publica AT (Produ\u00e7\u00e3o).cer > Resources\\Certificates\\ChavePublicaAT.cer   Warning  Filenames are diferent from target filenames, and note that we removed last  [s]  from TesteWebService [s] .pfx   2) Restart windows service and test again",
            "title": "Problems With Expired Certificate"
        },
        {
            "location": "/build-and-debug/",
            "text": "Source Code Config > \nlogicpos\\App.config\n\n\n\n\nNote\n\n\nIf we are building from source code we edit \nlogicpos\\App.config\n if we are working with install version or build version we change \nlogicpos\\bin\\Debug\\logicpos.exe.config\n\n\n\n\nHere we are working with Source Code  \nlogicpos\\App.config\n\n\nLogicpulse LogicPos : Build and Debug LogicPos Quick Setup Notes\n\n\nOpen Solution in Visual Studio 2015/2017\n\n\n\n\nWarning\n\n\nUnder Construction...\n\n\n\n\n\n\nHow to Build and Debug \nlogicpos.financial.service\n Project\n\n\n\n\nFirst Check if certificates are in \nlogicpos.financial.service\\Resources\\Certificates\n directory\n\n\n\n\nlogicpos.framework\\logicpos.financial.service\\Resources\\Certificates\\508278155.pfx\nlogicpos.framework\\logicpos.financial.service\\Resources\\Certificates\\508278155_1115.cer\nlogicpos.framework\\logicpos.financial.service\\Resources\\Certificates\\TesteWebService.pfx\nlogicpos.framework\\logicpos.financial.service\\Resources\\Certificates\\ChavePublicaAT.cer\n\n\n\n\n\n\n\n\n\nNext set \nlogicpos.financial.service\n project \nSet as Startup Project\n\n\n\n\n\n\nRun project\n\n\n\n\n\n\nPress [Y or Enter] to launch WebService in \ninteractive develop/debug\n\n\n\n\n\n\nBootStrap Framework Console Service Project....\nServicesATDCTestMode: [True]\nLaunch service? [Y or Enter] or any other key to run in interactive develop/debug mode\n\n...\n\npressed y\n...\n\nThe service is ready at http://localhost:50391/Service1.svc\nPress any key to stop the service and exit\n\n\n\n\n\n\n\nNote\n\n\n\n\nNote\"\n    \nServicesATDCTestMode: [True]\n : We are working on SandBox/Test Mode\n\n\n\n\n\n\nLaunch LogicPos \nlogicpos_pos\\logicpos\\bin\\Debug\\logicpos.exe\n and Make some Financial/WayBill Documents\n\n\n\n\n\n\nIf everything is working we can see in console\n\n\n\n\n\n\nSimplified Invoice\n\n\nSend Document DocumentNumber: [FS FS002012018S01/27]/WayBillMode: [False]\nCert Subject: [CN=TesteWebServices, OU=ASI, O=AT - Autoridade Tributaria e Aduaneira, L=Lisboa, S=Lisboa, C=PT], NotBefore: [02/08/2017 15:06:39], NotAfter: [29/01/2018 14:06:39]\nSend Document ReturnCode: [0]\nSend Document ReturnMessage: [Documento registado com sucesso.]\n\n\n\n\n\nWayBill\n\n\nSend Document DocumentNumber: [GT GT002012018S01/4]/WayBillMode: [True]\nCert Subject: [CN=TesteWebServices, OU=ASI, O=AT - Autoridade Tributaria e Aduaneira, L=Lisboa, S=Lisboa, C=PT], NotBefore: [02/08/2017 15:06:39], NotAfter: [29/01/2018 14:06:39]\nSend Document ReturnCode: [0]\nSend Document ReturnMessage: [OK]\n\n\n\n\n\n\n\nNote\n\n\nWayBills from FinalConsumer are never sent to WebService\n\n\n\n\nwhen build from source code\n\n\nLocation of Log File\n\n\nlogicpos.framework\\logicpos.financial.service\\bin\\Debug\\logicpos.financial.service.log \n\n\n\n\n\n\n\nTo Enable/Disable AT Webservice\n\n\nTo Enable/Disable sending documents to AT, we can change above parameters in config\n\n\n<!-- AT Web Services -->\n\n\n<add\n \nkey=\n\"serviceATSendDocuments\"\n \nvalue=\n\"true\"\n \n/>\n\n\n<add\n \nkey=\n\"serviceATSendDocumentsWayBill\"\n \nvalue=\n\"true\"\n \n/>\n\n\n\n\n\n\n\n\nDebug AT WebService\n\n\nTo Debug AT WebService, we debug \nlogicpulse.financial.service\n and launch \nlogicpos\n from bin\n\n\nDados usados\n\n\nhttps://faturas.portaldasfinancas.gov.pt/testarLigacaoWebService.action\n\n\npasswordCertificate = \"TESTEwebservice\";\ntaxRegistrationNumber = \"599999993\";\naccountFiscalNumber = \"599999993/0037\";\naccountPassword = \"testes1234\";\n\n\nDownload \n\n\nhttps://faturas.portaldasfinancas.gov.pt/factemipf_static/java/certificados.zip\n\n\npublic static Dictionary\n ServiceSendPendentDocuments()\n\n\n1\n2\n3\n4\n    //ATWS: Send Document to AT WebWebService\n    public static ServicesATSoapResult SendDocumentToATWS(FIN_DocumentFinanceMaster pDocumentFinanceMaster)\n    ...\n    bool sendDocumentToATWS = SendDocumentToATWSEnabled(pDocumentFinanceMaster);\n\n\n\n\n\n\nlogicpos\\\n\n\nlogicpos.framework\\\n  logicpos.financial\\\n  logicpos.financial.console\\\n  logicpos.financial.service\\\n  logicpos.financial.servicewcf\\\n\n\nlogicpos.hardware\\\n  printer.generic\\\n  printer.genericlinux\\\n  printer.genericsocket\\\n  printer.genericusb\\\n  printer.genericwindows\\\n\n\nlogicpos.plugins\\\n  PluginContracts\\\n  PluginLibrary\\\n  Plugins\\\n    FirstPlugin\\\n    LicenceManager\\\n    PluginModuleAImplA\\\n    PluginModuleAImplB\\\n    SecondPlugin\\  \n\n\nlogicpos.resources\\",
            "title": "Build and debug"
        },
        {
            "location": "/build-and-debug/#logicpulse-logicpos-build-and-debug-logicpos-quick-setup-notes",
            "text": "",
            "title": "Logicpulse LogicPos : Build and Debug LogicPos Quick Setup Notes"
        },
        {
            "location": "/build-and-debug/#open-solution-in-visual-studio-20152017",
            "text": "Warning  Under Construction...",
            "title": "Open Solution in Visual Studio 2015/2017"
        },
        {
            "location": "/build-and-debug/#how-to-build-and-debug-logicposfinancialservice-project",
            "text": "First Check if certificates are in  logicpos.financial.service\\Resources\\Certificates  directory   logicpos.framework\\logicpos.financial.service\\Resources\\Certificates\\508278155.pfx\nlogicpos.framework\\logicpos.financial.service\\Resources\\Certificates\\508278155_1115.cer\nlogicpos.framework\\logicpos.financial.service\\Resources\\Certificates\\TesteWebService.pfx\nlogicpos.framework\\logicpos.financial.service\\Resources\\Certificates\\ChavePublicaAT.cer    Next set  logicpos.financial.service  project  Set as Startup Project    Run project    Press [Y or Enter] to launch WebService in  interactive develop/debug    BootStrap Framework Console Service Project....\nServicesATDCTestMode: [True]\nLaunch service? [Y or Enter] or any other key to run in interactive develop/debug mode\n\n...\n\npressed y\n...\n\nThe service is ready at http://localhost:50391/Service1.svc\nPress any key to stop the service and exit   Note   Note\"\n     ServicesATDCTestMode: [True]  : We are working on SandBox/Test Mode    Launch LogicPos  logicpos_pos\\logicpos\\bin\\Debug\\logicpos.exe  and Make some Financial/WayBill Documents    If everything is working we can see in console    Simplified Invoice  Send Document DocumentNumber: [FS FS002012018S01/27]/WayBillMode: [False]\nCert Subject: [CN=TesteWebServices, OU=ASI, O=AT - Autoridade Tributaria e Aduaneira, L=Lisboa, S=Lisboa, C=PT], NotBefore: [02/08/2017 15:06:39], NotAfter: [29/01/2018 14:06:39]\nSend Document ReturnCode: [0]\nSend Document ReturnMessage: [Documento registado com sucesso.]  WayBill  Send Document DocumentNumber: [GT GT002012018S01/4]/WayBillMode: [True]\nCert Subject: [CN=TesteWebServices, OU=ASI, O=AT - Autoridade Tributaria e Aduaneira, L=Lisboa, S=Lisboa, C=PT], NotBefore: [02/08/2017 15:06:39], NotAfter: [29/01/2018 14:06:39]\nSend Document ReturnCode: [0]\nSend Document ReturnMessage: [OK]   Note  WayBills from FinalConsumer are never sent to WebService   when build from source code  Location of Log File  logicpos.framework\\logicpos.financial.service\\bin\\Debug\\logicpos.financial.service.log",
            "title": "How to Build and Debug logicpos.financial.service Project"
        },
        {
            "location": "/build-and-debug/#to-enabledisable-at-webservice",
            "text": "To Enable/Disable sending documents to AT, we can change above parameters in config  <!-- AT Web Services -->  <add   key= \"serviceATSendDocuments\"   value= \"true\"   />  <add   key= \"serviceATSendDocumentsWayBill\"   value= \"true\"   />",
            "title": "To Enable/Disable AT Webservice"
        },
        {
            "location": "/build-and-debug/#debug-at-webservice",
            "text": "To Debug AT WebService, we debug  logicpulse.financial.service  and launch  logicpos  from bin  Dados usados  https://faturas.portaldasfinancas.gov.pt/testarLigacaoWebService.action  passwordCertificate = \"TESTEwebservice\";\ntaxRegistrationNumber = \"599999993\";\naccountFiscalNumber = \"599999993/0037\";\naccountPassword = \"testes1234\";  Download   https://faturas.portaldasfinancas.gov.pt/factemipf_static/java/certificados.zip  public static Dictionary  ServiceSendPendentDocuments()  1\n2\n3\n4     //ATWS: Send Document to AT WebWebService\n    public static ServicesATSoapResult SendDocumentToATWS(FIN_DocumentFinanceMaster pDocumentFinanceMaster)\n    ...\n    bool sendDocumentToATWS = SendDocumentToATWSEnabled(pDocumentFinanceMaster);   logicpos\\  logicpos.framework\\\n  logicpos.financial\\\n  logicpos.financial.console\\\n  logicpos.financial.service\\\n  logicpos.financial.servicewcf\\  logicpos.hardware\\\n  printer.generic\\\n  printer.genericlinux\\\n  printer.genericsocket\\\n  printer.genericusb\\\n  printer.genericwindows\\  logicpos.plugins\\\n  PluginContracts\\\n  PluginLibrary\\\n  Plugins\\\n    FirstPlugin\\\n    LicenceManager\\\n    PluginModuleAImplA\\\n    PluginModuleAImplB\\\n    SecondPlugin\\    logicpos.resources\\",
            "title": "Debug AT WebService"
        }
    ]
}